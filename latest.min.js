(function($){Fancy.require({jQuery:false,Fancy:"1.0.1"});var i=1,NAME="FancyScroll",VERSION="1.0.1",timer=0,mouse={},logged=false;function FancyScroll(element,settings){var el=$(element)[0].nodeName=="#document"?$("body"):$(element);var SELF=this;SELF.id=i;SELF.name=NAME;SELF.version=VERSION;SELF.element=el;SELF.disabled=false;SELF.isBody=el[0].nodeName=="#document"||el[0].nodeName=="BODY";SELF.wrapper=el.parent();SELF.timer=[];i++;if(!logged){logged=true;Fancy.version(SELF)}SELF.settings=$.extend({},Fancy.settings[NAME],settings);SELF.direction={};SELF.init();SELF.addEventListener();SELF.hideCursor();SELF.resize();SELF.position();return SELF}FancyScroll.api=FancyScroll.prototype={};FancyScroll.api.version=VERSION;FancyScroll.api.name=NAME;FancyScroll.api.init=function(){var SELF=this;SELF.y=$("<div/>",{id:SELF.name+"-y-"+SELF.id,"class":SELF.name+"-rail "+SELF.name+"-y-rail"});SELF.y.cursor=$("<div/>",{id:SELF.name+"-y-cursor-"+SELF.id,"class":SELF.name+"-cursor"});SELF.x=$("<div/>",{id:SELF.name+"-x-"+SELF.id,"class":SELF.name+"-rail "+SELF.name+"-x-rail"});SELF.x.cursor=$("<div/>",{id:SELF.name+"-x-cursor-"+SELF.id,"class":SELF.name+"-cursor"});SELF.left=SELF.element.scrollLeft();SELF.top=SELF.element.scrollTop();SELF.element.addClass(SELF.name+"-element");if(SELF.settings.mobile?true:!Fancy.mobile)SELF.element.css({overflow:"hidden"});else SELF.element.css({overflow:"auto"});if(SELF.settings.y&&SELF.settings.mobile?true:!Fancy.mobile){SELF.y.append(SELF.y.cursor);SELF.wrapper.append(SELF.y)}if(SELF.settings.x&&SELF.settings.mobile?true:!Fancy.mobile){}SELF.y.cursor.css({background:SELF.settings.cursorColor,position:"relative",right:0,border:SELF.settings.borderColor?"1px solid "+SELF.settings.borderColor:"",borderRadius:SELF.settings.borderRadius,cursor:SELF.settings.cursorCursor}).addClass(SELF.name+"-theme-"+SELF.settings.theme+"-cursor");SELF.x.cursor.css({background:SELF.settings.cursorColor,position:"relative",top:0,border:SELF.settings.borderColor?"1px solid "+SELF.settings.borderColor:"",borderRadius:SELF.settings.borderRadius,cursor:SELF.settings.cursorCursor}).addClass(SELF.name+"-theme-"+SELF.settings.theme+"-cursor");SELF.y.css({position:SELF.isBody?"fixed":"absolute",backgroundColor:SELF.settings.railColor,width:SELF.settings.cursorWidth}).addClass(SELF.name+"-theme-"+SELF.settings.theme+"-rail");SELF.x.css({position:SELF.isBody?"fixed":"absolute",backgroundColor:SELF.settings.railColor,width:SELF.settings.cursorWidth}).addClass(SELF.name+"-theme-"+SELF.settings.theme+"-rail")};FancyScroll.api.showCursor=function(rail){if(!this.disabled&&this.ratioY>1&&(!rail||rail=="y")){this.y.removeClass(this.name+"-mode-"+this.settings.hideMode+"-out").addClass(this.name+"-mode-"+this.settings.hideMode+"-in");if(this.settings.autoHide)this.delay(function(){if(!this.y.cursor.active&&!this.y.cursor.dragged)this.hideCursor()},1e3)}if(!this.disabled&&this.ratioX>1&&(!rail||rail=="x")){this.x.removeClass(this.name+"-mode-"+this.settings.hideMode+"-out").addClass(this.name+"-mode-"+this.settings.hideMode+"-in");if(this.settings.autoHide)this.delay(function(){if(!this.x.cursor.active&&!this.y.cursor.dragged)this.hideCursor()},1e3)}return this};FancyScroll.api.hideCursor=function(){if(!this.disabled){this.y.removeClass(this.name+"-mode-"+this.settings.hideMode+"-in").addClass(this.name+"-mode-"+this.settings.hideMode+"-out");this.x.removeClass(this.name+"-mode-"+this.settings.hideMode+"-in").addClass(this.name+"-mode-"+this.settings.hideMode+"-out")}return this};FancyScroll.api.disable=function(){this.hideCursor();this.disabled=true;this.y.hide().removeClass(this.name+"-mode-"+this.settings.hideMode+"-in").addClass(this.name+"-mode-"+this.settings.hideMode+"-in");this.x.hide().removeClass(this.name+"-mode-"+this.settings.hideMode+"-in").addClass(this.name+"-mode-"+this.settings.hideMode+"-in");return this};FancyScroll.api.enable=function(){var SELF=this;SELF.disabled=false;SELF.y.css("display","");SELF.x.css("display","");return SELF};FancyScroll.api.resize=function(){var SELF=this;if(SELF.isBody){SELF.element.wtsY=SELF.element[0].scrollHeight-window.innerHeight}else{SELF.element.wtsY=SELF.element[0].scrollHeight-SELF.element.outerHeight()}if(SELF.isBody){SELF.element.wtsX=SELF.element[0].scrollWidth-window.innerWidth}else{SELF.element.wtsX=SELF.element[0].scrollWidth-SELF.element.outerWidth()}SELF.y.css({top:SELF.element.position().top+parseInt(SELF.element.css("borderTop")||0)+parseInt(SELF.element.css("marginTop")||0),height:SELF.isBody?"100%":SELF.element.innerHeight()});SELF.x.css({left:SELF.element.position().left+parseInt(SELF.element.css("marginRight")),width:SELF.isBody?"100%":SELF.element.outerWidth()});SELF.y.cursor.css({height:SELF.y.height()-SELF.y.height()*(SELF.element.wtsY/SELF.element[0].scrollHeight),minHeight:SELF.settings.cursorMinHeight});SELF.x.cursor.css({width:SELF.element.outerWidth()-SELF.element.outerWidth()*(SELF.element.wtsX/SELF.element[0].scrollWidth),minWidht:SELF.settings.cursorMinHeight});SELF.moveCursor();SELF.y.wts=SELF.y.height()-SELF.y.cursor.outerHeight();SELF.x.wts=SELF.x.width()-SELF.x.cursor.outerWidth();SELF.ratioY=SELF.element.wtsY/SELF.y.wts;SELF.ratioX=SELF.element.wtsX/SELF.x.wts;if(SELF.ratioY<1)SELF.y.css("display","none");else SELF.y.css("display","");if(SELF.ratioX<1)SELF.x.css("display","none");else SELF.x.css("display","");return SELF};FancyScroll.api.destroy=function(){this.element.removeClass(this.name+"-element");this.element.css("overflow","").unbind("."+this.name);$(window).unbind("."+this.name);$("html").css({cursor:""});this.y.remove();this.x.remove()};FancyScroll.api.addEventListener=function(){var SELF=this,scrolltimer=0,lastY=0;function doScroll(e){clearTimeout(SELF.timer["scroll"]);SELF.timer["scroll"]=setTimeout(function(){scrolltimer=false},3);if(scrolltimer)return;scrolltimer=true;if(!SELF.disabled){if(SELF.settings.mobile?true:!Fancy.mobile){var delta=0;if(!e)e=window.event;if(e.wheelDelta){delta=e.wheelDelta/120}else if(e.detail){delta=-e.detail/3}var closest=$(e.target).closest("."+SELF.name+"-element"),up=delta>0,scrollable=Fancy.scrollParent($(e.target));if(SELF.settings.preventDefault&&(closest.length&&!closest.is(SELF.element))){SELF.debug("has fancyscroll");if(up&&closest.data("FancyScroll").infinite&&closest.data("FancyScroll").infinite.last.up){SELF.debug("the "+SELF.name+"-element has infiniteScroll, is currently on way up and is not on top yet");return true}if(up&&closest.scrollTop()){SELF.debug("the "+SELF.name+"-element is currently on way up and is not on top yet");return}else if(!up&&closest.scrollTop()<closest[0].scrollHeight-closest.outerHeight()){SELF.debug("the "+SELF.name+"-element is currently on way down and is not on bottom yet");return true}}if(SELF.settings.preventDefault&&(!scrollable.is(SELF.element)&&!scrollable.is($(document)))){SELF.debug("scrollable parent");if(up&&scrollable.scrollTop()){SELF.debug("the container, the mouse is in, is currently on way up and didnt stop on top");return}else if(!up&&scrollable.scrollTop()<scrollable[0].scrollHeight-scrollable.outerHeight()){SELF.debug("the container, the mouse is in, is currently on way down and didnt stop on bottom");return true}}if(Fancy.mobile){var currentY=e.touches&&e.touches[0].clientY;up=currentY>=lastY;if(up){SELF.scrollTo(SELF.left,SELF.top-(currentY-lastY))}else{SELF.scrollTo(SELF.left,SELF.top+(lastY-currentY))}lastY=currentY}else{if(up){SELF.scrollTo(SELF.left,SELF.top-SELF.settings.scrollValue*delta)}else{SELF.scrollTo(SELF.left,SELF.top+SELF.settings.scrollValue*-delta)}}e.preventDefault()}else{SELF.scrollEvents()}}else{e.preventDefault()}}SELF.element.on("mouseenter."+SELF.name,function(){if(!SELF.disabled){SELF.y.addClass("hovered");SELF.showCursor()}}).on("mouseleave."+SELF.name,function(){SELF.y.removeClass("hovered")}).on("touchstart",function(e){lastY=e.originalEvent.touches[0].clientY});SELF.element.on("DOMMouseScroll."+this.name+" mousewheel."+this.name+" MozMousePixelScroll."+this.name+" touchmove."+this.name,function(e){doScroll(e.originalEvent)});SELF.element[0].onmousewheel=SELF.element[0].onmousewheel=doScroll;SELF.y.on("mouseenter."+SELF.name,function(){SELF.y.addClass("hovered");SELF.y.cursor.active=true;SELF.showCursor()}).on("mouseleave."+SELF.name,function(){SELF.y.removeClass("hovered");SELF.y.cursor.active=false});SELF.y.cursor.on("mousedown."+SELF.name,function(e){"use strict";mouse={};mouse.start=e.clientY;mouse.old=e.clientY;SELF.y.cursor.dragged=true;SELF.y.cursor.active=true;$("html").css({cursor:SELF.settings.cursorCursor});mouse.wts={};mouse.wts.up=mouse.start-parseInt(SELF.y.cursor.css("top"))-2;mouse.wts.down=mouse.start+SELF.y.wts-parseInt(SELF.y.cursor.css("top"))+2;$(document,"body").on("selectstart."+SELF.name,function(event){"use strict";event.preventDefault()})});$(window).on("mousemove."+SELF.name,function(e){"use strict";if(SELF.y.cursor.dragged){var wts;if(SELF.isBody&&!Fancy.isChrome){wts=SELF.wrapper.scrollTop()+SELF.element.wtsY/SELF.y.wts*(e.clientY-mouse.old)}else{wts=SELF.element.scrollTop()+SELF.element.wtsY/SELF.y.wts*(e.clientY-mouse.old)}SELF.scrollTo(SELF.left,Math.round(wts));SELF.resize();if(e.clientY>=mouse.wts.up&&e.clientY<=mouse.wts.down){mouse.old=e.clientY}}});$(window).on("mouseup."+SELF.name+" touchend."+SELF.name,function(){"use strict";$(document).unbind("selectstart."+SELF.name);$("html").css({cursor:""});mouse={};SELF.y.cursor.active=false;SELF.y.cursor.dragged=false});var MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){SELF.resize();SELF.position()})});observer.observe(SELF.element[0],{subtree:false,attributeOldValue:false,attributes:true,childList:true,characterData:true});SELF.element.on("DOMAttrModified",function(e){if(e.attrName==="style"){SELF.resize();SELF.position()}})};FancyScroll.api.position=function(){this.y.css({left:this.element.position().left-this.settings.margin+this.element.outerWidth()-this.y.width()-parseInt(this.element.css("borderRight")||0)+parseInt(this.element.css("marginLeft"))});this.x.css({top:this.element.position().top-this.settings.margin+this.element.outerHeight()-this.x.height()+parseInt(this.element.css("marginTop"))});return this};FancyScroll.api.scrollTo=function(x,y,speed){var SELF=this;if(x<0)x=0;if(y<0)y=0;if(x>SELF.element.wtsX)x=SELF.element.wtsX;if(y>SELF.element.wtsY)y=SELF.element.wtsY;if(x>SELF.left)SELF.direction.x="right";else if(x<SELF.left)SELF.direction.x="left";else SELF.direction.x=false;if(y>SELF.top)SELF.direction.y="down";else if(y<SELF.top)SELF.direction.y="up";else SELF.direction.y=false;function scrollLeft(type){SELF[type].scrollLeft(x);SELF.left=x;if(SELF.direction.x)SELF.scrollEvents()}function scrollTop(type){SELF[type].scrollTop(y);SELF.top=y;if(SELF.direction.y)SELF.scrollEvents()}scrollTop("element");scrollLeft("element");SELF.moveCursor();SELF.resize();SELF.showCursor();return SELF};FancyScroll.api.moveCursor=function(){var SELF=this;function move(type){var rx=(SELF.y.height()-SELF.y.cursor.outerWidth())/SELF.element.wtsX,ry=(SELF.y.height()-SELF.y.cursor.outerHeight())/SELF.element.wtsY,sx=SELF.left*rx,sy=SELF.top*ry,x=SELF.scrollDirection=="up"?Math.max(0,sx):Math.min(SELF.x.wts,sx),y=SELF.scrollDirection=="up"?Math.max(0,sy):Math.min(SELF.y.wts,sy);SELF.y.cursor.css({top:SELF[type].scrollTop()*ry});SELF.x.cursor.css({left:SELF[type].scrollLeft()*rx})}move("element");return SELF};FancyScroll.api.delay=function(callback,ms){var SELF=this;clearTimeout(timer);timer=setTimeout(function(){callback.call(SELF)},ms)};FancyScroll.api.timeout=function(callback,ms){var SELF=this;setTimeout(function(){callback.call(SELF)},ms)};FancyScroll.api.scrollEvents=function(){var SELF=this;function triggerEvent(type){var event=$.Event({type:SELF.name+":"+type,FancyScroll:SELF,y:SELF.y,x:SELF.x});SELF.element.trigger(event)}if(SELF.settings.beforeTop.toString().indexOf("%")>0){if(SELF.element.scrollTop()*100/SELF.element.wtsY<=parseInt(SELF.settings.beforeTop)&&SELF.direction.y=="up"){triggerEvent("top")}}else{if(SELF.element.scrollTop()<=SELF.settings.beforeTop&&SELF.direction.y=="up"){triggerEvent("top")}}if(SELF.settings.beforeBottom.toString().indexOf("%")>0){if(SELF.element.scrollTop()*100/SELF.element.wtsY>=100-parseInt(SELF.settings.beforeBottom)&&SELF.direction.y=="down"){triggerEvent("bottom")}}else{if(SELF.element.scrollTop()>=SELF.element.wtsY-SELF.settings.beforeBottom&&SELF.direction.y=="down"){triggerEvent("bottom")}}SELF.element.trigger(SELF.name+":scroll");SELF.element.trigger(SELF.name+":"+SELF.scrollDirection)};FancyScroll.api.debug=function(){if(this.settings.debug)console.log(arguments)};Fancy.settings[NAME]={scrollValue:100,margin:0,beforeTop:0,beforeBottom:0,cursorMinHeight:false,cursorWidth:false,cursorColor:false,railColor:false,mobile:false,selectEnabled:true,autoHide:true,preventDefault:true,borderColor:false,borderRadius:false,smooth:false,linear:false,x:false,y:true,debug:false,theme:"default",cursorCursor:"pointer",hideMode:"fade"};Fancy.scroll=VERSION;Fancy.api.scroll=function(settings){return this.set(NAME,function(el){return new FancyScroll(el,settings)})}})(jQuery);